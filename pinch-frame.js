const v=(s,t,e)=>s<t?t:s>e?e:s,f=s=>s<0?0:s,g=(s,t)=>{let e=0;for(let i=0;i<s.length;i++)e+=t(s[i]);return e},u=(s,t)=>s.length===1?t(s[0]):g(s,t)/s.length,m=s=>{let t;const e=()=>(t=void 0,s());return[()=>t??=requestAnimationFrame(e),()=>t!==void 0&&(cancelAnimationFrame(t),t=void 0)]};class p extends HTMLElement{static observedAttributes=["scale","min-scale","max-scale","offset-x","offset-y"];#t=1;get scale(){return this.#t}set scale(t){this.#t!==t&&(this.#s("scale",this.#t=t=v(t,this.#e,this.#i)),this.#d.style.transform=`scale(${t})`)}#e=.1;get minScale(){return this.#e}set minScale(t){this.#e!==t&&t>0&&(this.#s("min-scale",this.#e=t),this.#t<t&&(this.scale=t))}#i=100;get maxScale(){return this.#i}set maxScale(t){this.#i!==t&&t>0&&(this.#s("max-scale",this.#i=t),this.#t>t&&(this.scale=t))}#n=0;get offsetX(){return this.#n}set offsetX(t){this.setOffset(t,this.#r)}#r=0;get offsetY(){return this.#r}set offsetY(t){this.setOffset(this.#n,t)}#h=0;#c=0;#o;#a;#d;#u;constructor(){super();const t=this.attachShadow({mode:"open"});t.innerHTML="<div part=container><div part=top-left></div><slot part=content></slot></div>",this.#o=t.firstElementChild,this.#a=this.#o.firstElementChild,this.#d=this.#a.nextElementSibling;{let e=1;const[i]=m(()=>e=1);this.#u=()=>{i(),e=0},this.addEventListener("scroll",()=>{if(e){const r=this.#b()[0].transformPoint({x:this.#h-this.scrollLeft,y:this.#c-this.scrollTop});this.#s("offset-x",this.#n=r.x),this.#s("offset-y",this.#r=r.y)}})}}#l=1;#s(t,e){this.#l=0,this.setAttribute(t,e),this.#l=1}attributeChangedCallback(t,e,i){this.#l&&e!==i&&(this[t.replace(/-([a-z])/g,(r,o)=>o.toUpperCase())]=+i)}connectedCallback(){this.setAttribute("scale",this.#t),this.setAttribute("min-scale",this.#e),this.setAttribute("max-scale",this.#i)}#f="";#m=[new DOMMatrixReadOnly,new DOMMatrixReadOnly];#b(){let t="";for(let e=this;e;e=e.parentElement){const i=getComputedStyle(e).transform;i&&i!=="none"&&(t=`${i} ${t}`)}if(this.#f!==t){const e=new DOMMatrix(t);e.e=e.f=0,this.#f=t,this.#m=[DOMMatrixReadOnly.fromMatrix(e),DOMMatrixReadOnly.fromMatrix(e.inverse())]}return this.#m}setOffset(t,e){if(this.#n===t&&this.#r===e)return;this.#s("offset-x",this.#n=t),this.#s("offset-y",this.#r=e);const{x:i,y:r}=this.#b()[1].transformPoint({x:t,y:e}),o=this.#o.style;o.margin=`${this.#c=f(r)}px 0 0 ${this.#h=f(i)}px`,o.width=`${i<0?this.clientWidth-i:0}px`,o.height=`${r<0?this.clientHeight-r:0}px`,this.#u(),this.scrollTo(f(-i),f(-r))}zoom(t,e,i){const r=this.#t,o=v(r*t,this.#e,this.#i);if(o===r)return;const a=o/r-1,l=this.#a.getBoundingClientRect();this.scale=o,this.setOffset(this.#n+a*(l.x-e),this.#r+a*(l.y-i))}}const y=s=>{let t=1,e,i;const[r]=m(()=>{s.zoom(t,e,i),t=1});return o=>{o.ctrlKey&&(o.preventDefault(),t*=.98**o.deltaY,{clientX:e,clientY:i}=o,r())}},E=s=>{let t,e,i,r;const[o]=m(()=>{s.setOffset(s.offsetX+i-t,s.offsetY+r-e),t=i,e=r}),a=n=>{n.currentTarget.setPointerCapture(n.pointerId),{clientX:t,clientY:e}=n},l=n=>{n.buttons===1&&(n.preventDefault(),{clientX:i,clientY:r}=n,o())},c=y(s);return[()=>{s.addEventListener("wheel",c),s.addEventListener("pointerdown",a),s.addEventListener("pointermove",l)},()=>{s.removeEventListener("wheel",c),s.removeEventListener("pointerdown",a),s.removeEventListener("pointermove",l)}]},L=s=>{let t={x:0,y:0,d:0},e=[];const[i,r]=m(()=>{const n=u(e,d=>d.x),h=u(e,d=>d.y),b=t.d&&u(e,d=>d.d);b&&s.zoom(b/t.d,n,h),s.setOffset(s.offsetX+n-t.x,s.offsetY+h-t.y),e=[],t={x:n,y:h,d:b}}),o=({touches:n})=>({x:u(n,h=>h.clientX),y:u(n,h=>h.clientY),d:n.length>1?Math.hypot(n[0].clientX-n[1].clientX,n[0].clientY-n[1].clientY):0}),a=n=>{r(),e=[],n.touches.length!==0&&(t=o(n))},l=n=>{n.preventDefault(),e.push(o(n)),i()},c={passive:!1};return[()=>{s.addEventListener("touchstart",a),s.addEventListener("touchend",a),s.addEventListener("touchmove",l,c)},()=>{s.removeEventListener("touchstart",a),s.removeEventListener("touchend",a),s.removeEventListener("touchmove",l,c)}]};class T extends p{static observedAttributes=[...super.observedAttributes,"disabled"];#t;#e=!1;get disabled(){return this.#e}set disabled(t){t=!!t,this.#e!==t&&((this.#e=t)?(this.#t[1](),this.setAttribute("disabled","")):(this.#t[0](),this.removeAttribute("disabled")))}constructor(){super(),this.#t=typeof ontouchend>"u"?E(this):L(this),this.#t[0]()}attributeChangedCallback(t,e,i){t==="disabled"?this.disabled=i!==null:super.attributeChangedCallback(t,e,i)}}customElements.define("pinch-frame",T);
