const u=(o,t,e)=>o<t?t:o>e?e:o,f=o=>o<0?0:o,b=(o,t)=>{let e=0;for(let s=0;s<o.length;s++)e+=t(o[s]);return e},c=(o,t)=>o.length===1?t(o[0]):b(o,t)/o.length,m=o=>{let t;const e=()=>(t=void 0,o());return[()=>t??=requestAnimationFrame(e),()=>t!==void 0&&(cancelAnimationFrame(t),t=void 0)]};class p extends HTMLElement{static observedAttributes=["scale","min-scale","max-scale","offset-x","offset-y"];#t=1;get scale(){return this.#t}set scale(t){this.#t!==t&&(this.#e("scale",this.#t=t=u(t,this.#s,this.#i)),this.#f.style.transform=`scale(${t})`)}#s=.1;get minScale(){return this.#s}set minScale(t){this.#s!==t&&t>0&&(this.#e("min-scale",this.#s=t),this.#t<t&&(this.scale=t))}#i=100;get maxScale(){return this.#i}set maxScale(t){this.#i!==t&&t>0&&(this.#e("max-scale",this.#i=t),this.#t>t&&(this.scale=t))}#n=0;get offsetX(){return this.#n}set offsetX(t){this.setOffset(t,this.#r)}#r=0;get offsetY(){return this.#r}set offsetY(t){this.setOffset(this.#n,t)}#h=0;#c=0;#o;#l;#f;#m;constructor(){super();const t=this.attachShadow({mode:"open"});t.innerHTML="<div part=container><div part=top-left></div><slot part=content></slot></div>",this.#o=t.firstElementChild,this.#l=this.#o.firstElementChild,this.#f=this.#l.nextElementSibling;{let e=1;const[s]=m(()=>e=1);this.#m=()=>{s(),e=0},this.addEventListener("scroll",()=>{if(e){const i=this.#b()[0].transformPoint({x:this.#h-this.scrollLeft,y:this.#c-this.scrollTop});this.#e("offset-x",this.#n=i.x),this.#e("offset-y",this.#r=i.y)}})}}#a=1;#e(t,e){this.#a=0,this.setAttribute(t,e),this.#a=1}attributeChangedCallback(t,e,s){this.#a&&e!==s&&(this[t.replace(/-([a-z])/g,(i,r)=>r.toUpperCase())]=+s)}connectedCallback(){this.setAttribute("scale",this.#t),this.setAttribute("min-scale",this.#s),this.setAttribute("max-scale",this.#i)}#d="";#u=[new DOMMatrixReadOnly,new DOMMatrixReadOnly];#b(){let t="";for(let e=this;e;e=e.parentElement){const s=getComputedStyle(e).transform;s&&s!=="none"&&(t=`${s} ${t}`)}if(this.#d!==t){const e=new DOMMatrix(t);e.e=e.f=0,this.#d=t,this.#u=[DOMMatrixReadOnly.fromMatrix(e),DOMMatrixReadOnly.fromMatrix(e.inverse())]}return this.#u}setOffset(t,e){if(this.#n===t&&this.#r===e)return;this.#e("offset-x",this.#n=t),this.#e("offset-y",this.#r=e);const{x:s,y:i}=this.#b()[1].transformPoint({x:t,y:e}),r=this.#o.style;r.margin=`${this.#c=f(i)}px 0 0 ${this.#h=f(s)}px`,r.width=`${s<0?this.clientWidth-s:0}px`,r.height=`${i<0?this.clientHeight-i:0}px`,this.#m(),this.scrollTo(f(-s),f(-i))}zoom(t,e,s){const i=this.#t,r=u(i*t,this.#s,this.#i);if(r===i)return;const l=r/i-1,n=this.#l.getBoundingClientRect();this.scale=r,this.setOffset(this.#n+l*(n.x-e),this.#r+l*(n.y-s))}}class y extends p{constructor(){if(super(),typeof ontouchend>"u"){{let t=1,e,s;const[i]=m(()=>{this.zoom(t,e,s),t=1});this.addEventListener("wheel",r=>{r.ctrlKey&&(r.preventDefault(),t*=.98**r.deltaY,{clientX:e,clientY:s}=r,i())})}{let t,e,s,i;const[r]=m(()=>{this.setOffset(this.offsetX+s-t,this.offsetY+i-e),t=s,e=i});this.addEventListener("pointerdown",l=>{l.currentTarget.setPointerCapture(l.pointerId),{clientX:t,clientY:e}=l}),this.addEventListener("pointermove",l=>{l.buttons===1&&(l.preventDefault(),{clientX:s,clientY:i}=l,r())})}}else{let t={x:0,y:0,d:0},e=[];const[s,i]=m(()=>{const n=c(e,h=>h.x),a=c(e,h=>h.y),d=t.d&&c(e,h=>h.d);d&&this.zoom(d/t.d,n,a),this.setOffset(this.offsetX+n-t.x,this.offsetY+a-t.y),e=[],t={x:n,y:a,d}}),r=({touches:n})=>({x:c(n,a=>a.clientX),y:c(n,a=>a.clientY),d:n.length>1?Math.hypot(n[0].clientX-n[1].clientX,n[0].clientY-n[1].clientY):0}),l=n=>{i(),e=[],n.touches.length!==0&&(t=r(n))};this.addEventListener("touchstart",l),this.addEventListener("touchend",l),this.addEventListener("touchmove",n=>{n.preventDefault(),e.push(r(n)),s()},{passive:!1})}}}customElements.define("pinch-frame",y);
