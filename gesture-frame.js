const p=(n,t,e)=>n<t?t:n>e?e:n,u=n=>n<0?0:n,g=(n,t)=>{let e=0;for(let s=0;s<n.length;s++)e+=t(n[s]);return e},f=(n,t)=>n.length===1?t(n[0]):g(n,t)/n.length,d=n=>{let t;const e=()=>(t=void 0,n());return[()=>t??=requestAnimationFrame(e),()=>t!==void 0&&(cancelAnimationFrame(t),t=void 0)]};class y extends HTMLElement{static observedAttributes=["scale","min-scale","max-scale","offset-x","offset-y"];#i=1;get scale(){return this.#i}set scale(t){t=p(t,this.#t,this.#e),this.#i!==t&&(this.#r("scale",this.#i=t),this.#f.style.transform=`scale(${t})`)}#t=.1;get minScale(){return this.#t}set minScale(t){this.#t!==t&&t>0&&(this.#r("min-scale",this.#t=t),this.#i<t&&(this.scale=t))}#e=100;get maxScale(){return this.#e}set maxScale(t){this.#e!==t&&t>0&&(this.#r("max-scale",this.#e=t),this.#i>t&&(this.scale=t))}#n=0;get offsetX(){return this.#n}set offsetX(t){this.setOffset(t,this.#s)}#s=0;get offsetY(){return this.#s}set offsetY(t){this.setOffset(this.#n,t)}#l=0;#c=0;#o;#h;#f;#u;constructor(){super();const t=this.attachShadow({mode:"open"});t.innerHTML="<div part=container><div part=top-left></div><slot part=content></slot></div>",this.#o=t.firstElementChild,this.#h=this.#o.firstElementChild,this.#f=this.#h.nextElementSibling;{let e=1;const[s]=d(()=>e=1);this.#u=()=>{s(),e=0},this.addEventListener("scroll",()=>{if(e){const r=this.#p()[0].transformPoint({x:this.#l-this.scrollLeft,y:this.#c-this.scrollTop});this.#r("offset-x",this.#n=r.x),this.#r("offset-y",this.#s=r.y)}})}}#a=1;#r(t,e){this.#a=0,this.setAttribute(t,e),this.#a=1}attributeChangedCallback(t,e,s){this.#a&&e!==s&&(this[t.replace(/-([a-z])/g,(r,o)=>o.toUpperCase())]=+s)}connectedCallback(){this.setAttribute("scale",this.#i),this.setAttribute("min-scale",this.#t),this.setAttribute("max-scale",this.#e)}#d="";#m=[new DOMMatrixReadOnly,new DOMMatrixReadOnly];#p(){let t="";for(let e=this;e;e=e.parentElement){const s=getComputedStyle(e).transform;s&&s!=="none"&&(t=`${s} ${t}`)}if(this.#d!==t){const e=new DOMMatrix(t);e.e=e.f=0,this.#d=t,this.#m=[DOMMatrixReadOnly.fromMatrix(e),DOMMatrixReadOnly.fromMatrix(e.inverse())]}return this.#m}setOffset(t,e){if(this.#n===t&&this.#s===e)return;this.#r("offset-x",this.#n=t),this.#r("offset-y",this.#s=e);const{x:s,y:r}=this.#p()[1].transformPoint({x:t,y:e}),o=this.#o.style;o.margin=`${this.#c=u(r)}px 0 0 ${this.#l=u(s)}px`,o.width=`${s<0?this.clientWidth-s:0}px`,o.height=`${r<0?this.clientHeight-r:0}px`,this.#u(),this.scrollTo(u(-s),u(-r))}zoom(t,e,s){const r=this.#i,o=p(r*t,this.#t,this.#e);if(o===r)return;const a=o/r-1,l=this.#h.getBoundingClientRect();this.scale=o,this.setOffset(this.#n+a*(l.x-e),this.#s+a*(l.y-s))}}const b=n=>n.preventDefault(),v={passive:!1},E=typeof ontouchend<"u";class x extends y{static observedAttributes=[...super.observedAttributes,"pan-x","pan-y","pan-button","pinch-zoom"];#i(t,e,s){return s=!!s,e!==s&&(s?this.setAttribute(t,""):this.removeAttribute(t)),s}#t=!1;get panX(){return this.#t}set panX(t){this.#t=this.#i("pan-x",this.#t,t)}#e=!1;get panY(){return this.#e}set panY(t){this.#e=this.#i("pan-y",this.#e,t)}#n=0;get panButton(){return this.#n}set panButton(t){this.#n!==t&&(this.setAttribute("pan-button",this.#n=t),t===2?this.addEventListener("contextmenu",b):this.removeEventListener("contextmenu",b))}#s=!1;get pinchZoom(){return this.#s}set pinchZoom(t){this.#s=this.#i("pinch-zoom",this.#s,t)}attributeChangedCallback(t,e,s){t==="pan-x"?this.panX=s!==null:t==="pan-y"?this.panY=s!==null:t==="pan-button"?this.panButton=+s||0:t==="pinch-zoom"?this.pinchZoom=s!==null:super.attributeChangedCallback(t,e,s)}constructor(){if(super(),E){let t={x:0,y:0,d:0},e=[];const[s,r]=d(()=>{const i=f(e,c=>c.x),h=f(e,c=>c.y),m=t.d&&f(e,c=>c.d);m&&this.#s&&this.zoom(m/t.d,i,h),this.setOffset(this.#t?this.offsetX+i-t.x:this.offsetX,this.#e?this.offsetY+h-t.y:this.offsetY),e=[],t={x:i,y:h,d:m}}),o=({touches:i})=>({x:f(i,h=>h.clientX),y:f(i,h=>h.clientY),d:i.length>1?Math.hypot(i[0].clientX-i[1].clientX,i[0].clientY-i[1].clientY):0}),a=i=>{r(),e=[],i.touches.length!==0&&(t=o(i))},l=i=>{(i.touches.length===1?this.#t||this.#e:this.#s)&&(i.preventDefault(),e.push(o(i)),s())};this.addEventListener("touchstart",a),this.addEventListener("touchend",a),this.addEventListener("touchmove",l,v)}else{{let t=1,e,s;const[r]=d(()=>{this.zoom(t,e,s),t=1});this.addEventListener("wheel",o=>{this.#s&&o.ctrlKey&&(o.preventDefault(),t*=.99**o.deltaY,{clientX:e,clientY:s}=o,r())},v)}{let t,e,s,r;const[o]=d(()=>{this.setOffset(this.#t?this.offsetX+s-t:this.offsetX,this.#e?this.offsetY+r-e:this.offsetY),t=s,e=r}),a=h=>{h.preventDefault(),{clientX:s,clientY:r}=h,o()},l=h=>{(this.#t||this.#e)&&h.button===this.#n&&({clientX:t,clientY:e}=h,addEventListener("pointermove",a))},i=()=>removeEventListener("pointermove",a);this.addEventListener("pointerdown",l),this.addEventListener("pointerup",i),this.addEventListener("pointercancel",i)}}}}customElements.define("gesture-frame",x);export{x as GestureFrame};
